# Le decimos a Caddy que estamos manejando HTTP internamente.
# Railway se encargará del HTTPS para el dominio público.
{
	auto_https off
}

# Escuchamos en el puerto 80 para todas las peticiones entrantes.
# Caddy usará automáticamente las variables de entorno aquí.
:80 {
	# --- Manejadores de Proxy ---
	handle_path /gotrue/* {
		reverse_proxy {$GOTRUE_BACKEND_HOST}:{$GOTRUE_BACKEND_PORT}
	}

	handle_path /minio-api/* {
		reverse_proxy {$MINIO_API_HOST}:{$MINIO_API_PORT}
	}

	handle_path /ws {
		reverse_proxy {$APPFLOWY_BACKEND_HOST}:{$APPFLOWY_BACKEND_PORT}
	}

	handle {
		reverse_proxy {$APPFLOWY_BACKEND_HOST}:{$APPFLOWY_BACKEND_PORT}
	}

	# --- Cabeceras Globales de CORS (La Versión Simple de la Plantilla) ---
	# Añadimos solo lo más básico. Dejamos que los backends
	# manejen las cabeceras más específicas como 'Allow-Credentials'.
	header {
		Access-Control-Allow-Origin "{$CORS_ORIGIN}"
		Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS"
		Access-Control-Allow-Headers "*"
	}
} 
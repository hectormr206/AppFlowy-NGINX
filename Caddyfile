# Le decimos a Caddy que estamos manejando HTTP internamente.
# Railway se encargará del HTTPS para el dominio público.
{
	auto_https off
}

# La variable PORT la define Railway (la hemos puesto en 80).
# Si no, Caddy escucharía en el 443 por defecto.
:{$PORT} {
	# --- Manejadores de Proxy ---
	# Usan las variables de entorno oficiales.
	# No se añade ninguna cabecera. Se deja que los backends lo hagan.
	
	handle_path /gotrue/* {
		reverse_proxy {$ENV_GOTRUE}:{$ENV_GOTRUE_PORT}
	}

	handle_path /minio-api/* {
		reverse_proxy {$ENV_MINIO}:{$ENV_MINIO_PORT}
	}

	handle_path /ws {
		reverse_proxy {$ENV_APPFLOWY_CLOUD}:{$ENV_APPFLOWY_CLOUD_PORT}
	}

	handle {
		reverse_proxy {$ENV_APPFLOWY_CLOUD}:{$ENV_APPFLOWY_CLOUD_PORT}
	}
} 